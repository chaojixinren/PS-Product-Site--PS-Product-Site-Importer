<div id="ps-product-site">
  <style>
    #ps-product-site { font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","PingFang SC","Hiragino Sans GB","Microsoft Yahei",sans-serif; padding: 16px; }
    .ps-container { max-width: 1200px; margin: 0 auto; }
    .ps-topbar { position: sticky; top: 0; z-index: 2; background: transparent; margin-bottom: 16px; }
    .ps-search-wrap { display: flex; gap: 12px; align-items: center; margin-bottom: 10px; }
    .ps-search { flex: 1; position: relative; }
    .ps-search input { width: 100%; height: 44px; border-radius: 999px; border: 1px solid #e5e7eb; padding: 0 44px 0 16px; outline: none; background:#fff; }
    .ps-search input:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,.15); }
    .ps-search .hint { position: absolute; right: 14px; top: 50%; transform: translateY(-50%); font-size: 12px; color: #6b7280; }
    .ps-strip { margin-top: 10px; display: flex; gap: 10px; overflow-x: auto; padding-bottom: 6px; scrollbar-width: thin; }
    .ps-pill { flex: 0 0 auto; min-width: 240px; max-width: 320px; border-radius: 14px; border: 1px solid #e5e7eb; background: #fff; padding: 12px; cursor: pointer; transition: box-shadow .2s, transform .2s; }
    .ps-pill:hover { box-shadow: 0 8px 24px rgba(0,0,0,.06); transform: translateY(-2px); }
    .ps-pill-title { font-weight: 700; color: #111827; margin-bottom: 6px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .ps-pill-desc { color: #6b7280; font-size: 12px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .ps-hero { margin-top: 16px; background: #0f3a86; color: #fff; border-radius: 28px; padding: 28px; }
    .ps-hero-inner { display: grid; grid-template-columns: 1.3fr .7fr; gap: 24px; align-items: center; }
    .ps-hero h2 { font-size: 32px; line-height: 1.2; margin: 0 0 16px; }
    .ps-hero p { color: #e5e7eb; line-height: 1.8; margin: 0; }
    .ps-hero-img { background: #fff; border-radius: 18px; display:flex; align-items:center; justify-content:center; padding: 18px; min-height: 240px; }
    .ps-hero-img img { max-width: 100%; height: auto; display:block; }
    .ps-spec { margin-top: 18px; background: #0f3a86; color:#fff; border-radius: 20px; padding: 16px; }
    .ps-tabs { display:flex; gap:10px; padding: 6px; }
    .ps-tab { padding: 8px 14px; border-radius: 999px; background:#1e40af; color:#dbeafe; cursor:pointer; font-weight:700; }
    .ps-tab.active { background:#e6efff; color:#0f3a86; }
    .ps-spec-body { background:#fff; border-radius: 14px; padding: 12px; }
    .ps-spec-body table { width:100%; border-collapse:collapse; }
    .ps-spec-body th, .ps-spec-body td { padding: 12px 14px; border-bottom: 1px solid #e5e7eb; color:#0f172a; }
    .ps-spec-body tr:last-child th, .ps-spec-body tr:last-child td { border-bottom:none; }
    .skeleton { background: linear-gradient(90deg, rgba(0,0,0,.06) 25%, rgba(0,0,0,.12) 37%, rgba(0,0,0,.06) 63%); background-size: 400% 100%; animation: shimmer 1.4s ease infinite; }
    @keyframes shimmer { 0%{background-position: 100% 0} 100%{background-position: -100% 0} }
    @media (max-width: 900px){ .ps-hero-inner { grid-template-columns: 1fr; } }

  /* Applications & Product Portfolio sections (v1.4.6) */
  .ps-section{margin-top:28px}
  .ps-split{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:center}
  .ps-split h3{font-size:28px;margin:0 0 14px}
  .ps-dotlist{list-style:none;margin:0;padding:0}
  .ps-dotlist li{line-height:1.9;color:#1f2937;position:relative;padding-left:14px}
  .ps-dotlist li::before{content:"·";position:absolute;left:0;top:0}
  .ps-split-img{border-radius:24px;overflow:hidden;background:#f6f7fb}
  .ps-split-img img{display:block;width:100%;height:auto}
  .ps-split-img.dark{background:linear-gradient(145deg,#0f2d66,#0b1d46)}
  @media (max-width:900px){ .ps-split{grid-template-columns:1fr} }

  /* 桌面端悬停卡片样式 (v1.4.6) */
  .ps-hover-cards{display:none;grid-template-columns:1fr 1fr;gap:16px;margin-top:28px}
  .ps-card{position:relative;height:300px;border-radius:20px;overflow:hidden;cursor:pointer;transition:transform .3s ease}
  .ps-card:hover{transform:translateY(-4px)}
  .ps-card-bg{position:absolute;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;background-repeat:no-repeat}
  .ps-card-overlay{position:absolute;bottom:0;left:0;right:0;background:rgba(255,255,255,0.95);padding:24px;transform:translateY(100%);transition:transform .3s ease;backdrop-filter:blur(10px)}
  .ps-card:hover .ps-card-overlay{transform:translateY(0)}
  .ps-card-overlay h3{font-size:24px;font-weight:700;color:#1f2937;margin:0 0 16px}
  .ps-card-list{list-style:none;margin:0;padding:0}
  .ps-card-list li{line-height:1.6;color:#374151;margin-bottom:8px;position:relative;padding-left:16px}
  .ps-card-list li::before{content:"•";position:absolute;left:0;top:0;color:#6b7280}

  /* 欢迎引导区域样式 */
  .ps-welcome{background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:24px;padding:64px 48px;margin:48px 0;text-align:center;min-height:400px;display:flex;align-items:center;justify-content:center}
  .ps-welcome-content{max-width:600px;margin:0 auto;width:100%}
  .ps-welcome h2{font-size:36px;color:#1e293b;margin:0 0 24px;font-weight:700}
  .ps-welcome p{font-size:20px;color:#64748b;margin:0 0 48px;line-height:1.6}
  .ps-welcome-features{display:flex;gap:40px;justify-content:center;flex-wrap:wrap}
  .ps-feature-item{display:flex;flex-direction:column;align-items:center;gap:12px;padding:24px;background:#fff;border-radius:20px;box-shadow:0 6px 20px rgba(0,0,0,.08);min-width:140px;transition:transform .2s,box-shadow .2s}
  .ps-feature-item:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,.12)}
  .ps-feature-icon{font-size:32px}
  .ps-feature-item span:last-child{font-size:16px;color:#475569;font-weight:600}
  

  /* 响应式媒体查询 (v1.4.6) */
  @media (min-width: 901px) {
    .ps-hover-cards { display: grid !important; }
    .ps-section { display: none !important; }
    #ps-app { display: none !important; }
    #ps-portfolio { display: none !important; }
  }
  @media (max-width: 900px) {
    .ps-hover-cards { display: none !important; }
    .ps-section { display: block !important; }
    #ps-app { display: block !important; }
    #ps-portfolio { display: block !important; }
  }

  @media (max-width:600px){ 
    .ps-welcome{padding:48px 24px;min-height:350px} 
    .ps-welcome h2{font-size:28px} 
    .ps-welcome p{font-size:18px;margin-bottom:40px} 
    .ps-welcome-features{gap:24px} 
    .ps-feature-item{min-width:120px;padding:20px}
    .ps-feature-icon{font-size:28px}
    .ps-feature-item span:last-child{font-size:15px}
  }

  </style>

  <div class="ps-container">
    <div class="ps-topbar">
      <div class="ps-search-wrap">
        <div class="ps-search">
          <input id="ps-search-input" type="search" placeholder="搜索产品名称、型号或参数（含表格参数）">
          <span class="hint">⌘/Ctrl+K</span>
        </div>
      </div>
      <div id="ps-strip" class="ps-strip"></div>
    </div>

    <!-- 初始引导区域 -->
    <div id="ps-welcome" class="ps-welcome">
      <div class="ps-welcome-content">
        <h2>Welcome to the product catalog</h2>
        <p>Please enter keywords to search for products. You can search for product names, models or technical parameters.</p>
        <div class="ps-welcome-features">
          <div class="ps-feature-item">
            <span>Product Details</span>
          </div>
          <div class="ps-feature-item">
            <span>Applications</span>
          </div>
          <div class="ps-feature-item">
            <span>Product Portfolio</span>
          </div>
        </div>
      </div>
    </div>

    <div id="ps-hero" class="ps-hero" style="display:none;">
      <div class="ps-hero-inner">
        <div class="ps-hero-text">
          <h2 id="ps-hero-title">Title</h2>
          <p id="ps-hero-desc">Desc</p>
        </div>
        <div class="ps-hero-img">
          <img id="ps-hero-img" alt="product image" onerror="this.style.display='none'">
        </div>
      </div>
    </div>

    <div id="ps-spec" class="ps-spec" style="display:none;">
      <div class="ps-tabs">
        <div id="ps-tab1" class="ps-tab active">RF Performance</div>
        <div id="ps-tab2" class="ps-tab">Protection Performance</div>
      </div>
      <div class="ps-spec-body">
        <div id="ps-spec1"></div>
        <div id="ps-spec2" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- v1.4.6: Applications & Product Portfolio with Hover Cards -->
  <!-- 桌面端悬停卡片布局 -->
  <div id="ps-hover-cards" class="ps-hover-cards" style="display:none;">
    <div class="ps-card ps-app-card">
      <div class="ps-card-bg" id="ps-app-bg"></div>
      <div class="ps-card-overlay">
        <h3 id="ps-app-card-title">Applications</h3>
        <ul id="ps-app-card-list" class="ps-card-list"></ul>
      </div>
    </div>
    <div class="ps-card ps-portfolio-card">
      <div class="ps-card-bg" id="ps-portfolio-bg"></div>
      <div class="ps-card-overlay">
        <h3 id="ps-portfolio-card-title">Product Portfolio</h3>
        <ul id="ps-portfolio-card-list" class="ps-card-list"></ul>
      </div>
    </div>
  </div>

  <!-- 移动端列表布局 -->
  <div id="ps-app" class="ps-section" style="display:none;">
    <div class="ps-split">
      <div>
        <h3 id="ps-app-title">Applications</h3>
        <ul id="ps-app-list" class="ps-dotlist"></ul>
      </div>
      <div class="ps-split-img"><img id="ps-app-img" alt=""></div>
    </div>
  </div>

  <div id="ps-portfolio" class="ps-section" style="display:none;">
    <div class="ps-split">
      <div>
        <h3 id="ps-portfolio-title">Product Portfolio</h3>
        <ul id="ps-portfolio-list" class="ps-dotlist"></ul>
      </div>
      <div class="ps-split-img dark"><img id="ps-portfolio-img" alt=""></div>
    </div>
  </div>

  <script>
  (function(){
    const ENDPOINT='__PS_PRODUCTS_ENDPOINT__';
    const $ = s => document.querySelector(s);
    const elStrip = $('#ps-strip');
    const elSearch = $('#ps-search-input');
    const elWelcome = document.getElementById('ps-welcome');
    const elHeroTitle = $('#ps-hero-title');
    const elHeroDesc = $('#ps-hero-desc');
    const elHeroImg = $('#ps-hero-img');
    const elHero = document.getElementById('ps-hero');
    const elSpec = document.getElementById('ps-spec');
    const elSpec1 = document.getElementById('ps-spec1');
    const elSpec2 = document.getElementById('ps-spec2');
    const elTab1 = document.getElementById('ps-tab1');
    const elTab2 = document.getElementById('ps-tab2');

    const elApp=document.getElementById('ps-app');
    const elAppTitle=document.getElementById('ps-app-title');
    const elAppList=document.getElementById('ps-app-list');
    const elAppImg=document.getElementById('ps-app-img');
    const elPf=document.getElementById('ps-portfolio');
    const elPfTitle=document.getElementById('ps-portfolio-title');
    const elPfList=document.getElementById('ps-portfolio-list');
    const elPfImg=document.getElementById('ps-portfolio-img');

    // 桌面端卡片元素
    const elHoverCards=document.getElementById('ps-hover-cards');
    const elAppCardTitle=document.getElementById('ps-app-card-title');
    const elAppCardList=document.getElementById('ps-app-card-list');
    const elAppBg=document.getElementById('ps-app-bg');
    const elPfCardTitle=document.getElementById('ps-portfolio-card-title');
    const elPfCardList=document.getElementById('ps-portfolio-card-list');
    const elPfBg=document.getElementById('ps-portfolio-bg');

    const state = { products:[], view:[], q:'' };

    function stripHtml(html){
      if(!html) return '';
      const tmp = document.createElement('div'); tmp.innerHTML = html;
      return (tmp.textContent||tmp.innerText||'').replace(/\\s+/g,' ').trim();
    }
    function buildIndex(p){
      const fields=[p.title,p.sub,p.desc,p.A6,p.A7,p.A9,p.A10,p.A12,p['Unnamed:_17'],p['Unnamed:_18'],stripHtml(p.table1),stripHtml(p.table2)];
      return fields.filter(Boolean).join(' ').toLowerCase();
    }
    function indexProducts(list){ list.forEach(p=> p._blob = buildIndex(p)); }

    function renderStrip(list){
      if(!list.length){ 
        elStrip.innerHTML='<div style="color:#6b7280">没有匹配的产品</div>'; 
        elStrip.style.display = 'flex';
        return; 
      }
      elStrip.innerHTML = list.map(p=>(
        '<div class="ps-pill" data-id="'+p.id+'">'
          +'<div class="ps-pill-title">'+(p.title||'')+'</div>'
          +'<div class="ps-pill-desc">'+(p.desc||'')+'</div>'
        +'</div>'
      )).join('');
      elStrip.style.display = 'flex';
      elStrip.onclick = e=>{
        const it=e.target.closest('.ps-pill'); if(!it) return;
        const id=it.getAttribute('data-id');
        const p = state.view.find(x=>String(x.id)===String(id));
        if(p) showDetail(p);
      };
    }

    function showDetail(p){
      elHeroTitle.textContent = p.title||'';
      elHeroDesc.textContent = p.desc||'';

      // Fallback order: img1 -> A5 -> A8 -> A11 -> (hide)
      const heroUrl = p.img1 || p.A5 || p.A8 || p.A11 || '';
      if(heroUrl){
        elHeroImg.src = heroUrl;
        elHeroImg.style.display='block';
      }else{
        elHeroImg.removeAttribute('src');
        elHeroImg.style.display='none';
      }

      elHero.style.display = 'block';

      const has1 = !!(p.table1 && p.table1.trim());
      const has2 = !!(p.table2 && p.table2.trim());
      if(has1||has2){
        elSpec.style.display='block';
        elSpec1.innerHTML = has1 ? p.table1 : '<div style="color:#0f172a; padding:8px 0;">暂无数据</div>';
        elSpec2.innerHTML = has2 ? p.table2 : '<div style="color:#0f172a; padding:8px 0;">暂无数据</div>';
        selectTab(1);
      }else{
        elSpec.style.display='none';
      }

      // v1.4.6 Applications (A6/A7) + image (A8) with hover cards
      (function(){
        const title = (p.A6||'').trim();
        const lines = (p.A7||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        const imgUrl = p.A8 || p.A5 || p.img1 || p.A11 || '';
        if(title || lines.length || imgUrl){
          // 填充移动端列表布局内容
          elAppTitle.textContent = title || 'Applications';
          elAppList.innerHTML = lines.map(s=>'<li>'+s+'</li>').join('') || '';
          if(imgUrl){ elAppImg.src = imgUrl; elAppImg.style.display='block'; }
          else { elAppImg.removeAttribute('src'); elAppImg.style.display='none'; }
          
          // 填充桌面端卡片布局内容
          elAppCardTitle.textContent = title || 'Applications';
          elAppCardList.innerHTML = lines.map(s=>'<li>'+s+'</li>').join('') || '';
          if(p.A8){ elAppBg.style.backgroundImage = 'url('+p.A8+')'; }
          else { elAppBg.style.backgroundImage = ''; }
          
          // 显示容器（CSS媒体查询会控制具体显示哪个）
          elApp.style.display='block';
          elHoverCards.style.display='grid';
        }else{
          elApp.style.display='none';
          elHoverCards.style.display='none';
        }
      })();

      // v1.4.6 Product Portfolio (A9/A10) + image (A11) with hover cards
      (function(){
        const title = (p.A9||'').trim();
        const lines = (p.A10||'').split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
        const imgUrl = p.A11 || p.A8 || p.A5 || p.img1 || '';
        if(title || lines.length || imgUrl){
          // 填充移动端列表布局内容
          elPfTitle.textContent = title || 'Product Portfolio';
          elPfList.innerHTML = lines.map(s=>'<li>'+s+'</li>').join('') || '';
          if(imgUrl){ elPfImg.src = imgUrl; elPfImg.style.display='block'; }
          else { elPfImg.removeAttribute('src'); elPfImg.style.display='none'; }
          
          // 填充桌面端卡片布局内容
          elPfCardTitle.textContent = title || 'Product Portfolio';
          elPfCardList.innerHTML = lines.map(s=>'<li>'+s+'</li>').join('') || '';
          if(p.A11){ elPfBg.style.backgroundImage = 'url('+p.A11+')'; }
          else { elPfBg.style.backgroundImage = ''; }
          
          // 显示容器（CSS媒体查询会控制具体显示哪个）
          elPf.style.display='block';
          elHoverCards.style.display='grid';
        }else{
          elPf.style.display='none';
          elHoverCards.style.display='none';
        }
      })();
      if(window.parent){ setTimeout(()=>{ try{ parent.postMessage({type:'ps-resize',id:'inline',h:document.body.scrollHeight},'*'); }catch(e){} }, 60); }
    }

    function selectTab(n){
      if(n===1){
        elTab1.classList.add('active'); elTab2.classList.remove('active');
        elSpec1.style.display='block'; elSpec2.style.display='none';
      }else{
        elTab2.classList.add('active'); elTab1.classList.remove('active');
        elSpec2.style.display='block'; elSpec1.style.display='none';
      }
    }
    elTab1.addEventListener('click', ()=>selectTab(1));
    elTab2.addEventListener('click', ()=>selectTab(2));

    function filterAndRender(){
      const q=(state.q||'').trim().toLowerCase();
      const terms = q? q.split(/\\s+/).filter(Boolean): [];
      
      // 如果搜索框为空，隐藏产品列表和详情，显示欢迎区域
      if(!q){
        elStrip.style.display = 'none';
        elHero.style.display = 'none';
        elSpec.style.display = 'none';
        elApp.style.display = 'none';
        elPf.style.display = 'none';
        elHoverCards.style.display = 'none';
        elWelcome.style.display = 'block';
        return;
      }
      
      // 有搜索内容时，显示产品列表，隐藏欢迎区域
      elStrip.style.display = 'flex';
      elWelcome.style.display = 'none';
      
      state.view = state.products.filter(p=>{
        if(!terms.length) return true;
        return terms.every(t => p._blob.indexOf(t)!==-1);
      });
      renderStrip(state.view);
      if(state.view.length) showDetail(state.view[0]);
    }

    let t; elSearch.addEventListener('input',()=>{ clearTimeout(t); t=setTimeout(()=>{ state.q = elSearch.value||''; filterAndRender(); },200); });
    window.addEventListener('keydown',e=>{ if((e.ctrlKey||e.metaKey)&&e.key.toLowerCase()==='k'){ e.preventDefault(); elSearch.focus(); } });

    function fetchProducts(){ return fetch(ENDPOINT,{credentials:'same-origin'}).then(r=>r.json()); }

    fetchProducts().then(list=>{
      state.products = Array.isArray(list)? list: [];
      indexProducts(state.products);
      // 初始加载时显示欢迎区域，隐藏产品列表
      elStrip.style.display = 'none';
      elWelcome.style.display = 'block';
    }).catch(err=>{ elStrip.innerHTML='<div style="color:#ef4444">数据加载失败</div>'; console.error(err); });
  })();
  </script>
</div>
